<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Fastraffic - Đăng ký lại</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; height: 100vh; margin: 0; display: flex; justify-content: center; align-items: center; }
        .box { background: #fff; padding: 35px; border-radius: 12px; width: 340px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        h2 { margin-bottom: 25px; color: #333; }
        .input-group { position: relative; margin-bottom: 15px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .show-btn { position: absolute; right: 10px; top: 10px; background: #eee; border: none; padding: 5px; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: bold; }
        .btn-red { width: 100%; padding: 13px; background: #e94560; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        #error { color: #ff4d4d; font-size: 13px; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <h2 id="title">ĐĂNG KÝ MỚI</h2>
    <div class="input-group">
        <input type="email" id="email" placeholder="Email của bạn">
    </div>
    <div class="input-group">
        <input type="password" id="pass" placeholder="Mật khẩu mới">
        <button type="button" class="show-btn" onclick="toggle()">HIỆN</button>
    </div>
    <button class="btn-red" onclick="handleRegister()">ĐĂNG KÝ NGAY</button>
    <div id="error"></div>
    <div style="margin-top:20px; font-size:14px;">
        Đã có tài khoản? <a href="index.html" style="color:#e94560; font-weight:bold;">Đăng nhập</a>
    </div>
</div>

<script>
    firebase.initializeApp({
        apiKey: "AIzaSyBka80W-Aa9m4NXQ7PD4kmx1xew-lz67l0",
        authDomain: "fastraffic-8b585.firebaseapp.com",
        projectId: "fastraffic-8b585",
    });

    function toggle() {
        const p = document.getElementById('pass');
        p.type = (p.type === "password") ? "text" : "password";
        event.target.innerText = (p.type === "password") ? "HIỆN" : "ẨN";
    }

    function handleRegister() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        const err = document.getElementById('error');
        err.innerText = "Đang xử lý...";

        // Xóa sạch session cũ trước khi đăng ký mới
        firebase.auth().signOut().then(() => {
            return firebase.auth().createUserWithEmailAndPassword(email, pass);
        })
        .then(() => {
            localStorage.setItem("userEmail", email);
            alert("Đăng ký thành công!");
            window.location.href = "home.html";
        })
        .catch(e => {
            if (e.code === 'auth/email-already-in-use') {
                err.innerText = "Lỗi: Email này vẫn còn tồn tại trong hàng chờ của Firebase. Hãy đợi 1 phút!";
            } else {
                err.innerText = "Lỗi: " + e.message;
            }
        });
    }
</script>
</body>
</html>
