async function handleAuth() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("pass").value;
    const err = document.getElementById("error");
    
    if(!email || !pass) return err.innerText = "Vui lòng nhập đủ!";
    err.innerText = "Đang xử lý...";

    try {
        if (isLoginMode) {
            // ĐĂNG NHẬP
            await firebase.auth().signInWithEmailAndPassword(email, pass);
            // Sử dụng đường dẫn tương đối để GitHub Pages nhận diện đúng
            window.location.replace("home.html"); 
        } else {
            // ĐĂNG KÝ
            const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, pass);
            // Tạo ví tiền ngay khi đăng ký
            await firebase.database().ref("users/" + userCredential.user.uid).set({
                email: email,
                money: 0
            });
            await firebase.auth().signOut();
            alert("Đăng ký thành công! Hãy đăng nhập.");
            switchMode(true);
        }
    } catch (e) { 
        err.innerText = "Lỗi: " + e.message; 
    }
}
