<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
<script>
    // Khởi tạo Firebase giống index.html
    firebase.initializeApp({
        apiKey: "AIzaSyBka80W-Aa9m4NXQ7PD4kmx1xew-lz67l0",
        authDomain: "fastraffic-8b585.firebaseapp.com",
        projectId: "fastraffic-8b585",
    });

    // Kiểm tra trạng thái đăng nhập liên tục
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) {
            // Nếu không có user hoặc tài khoản bị vô hiệu hóa/xóa
            localStorage.removeItem("userEmail");
            window.location.href = "index.html";
        } else {
            // Ép buộc làm mới token để kiểm tra trạng thái Disable ngay lập tức
            user.getIdToken(true).catch(() => {
                alert("Tài khoản của bạn đã bị vô hiệu hóa!");
                window.location.href = "index.html";
            });
        }
    });
</script>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fastraffic - Trang chủ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; background: #f4f7f6; }
        .sidebar { width: 250px; background: #fff; height: 100vh; border-right: 1px solid #ddd; position: fixed; }
        .sidebar-header { padding: 20px; font-weight: bold; color: #e94560; font-size: 20px; text-align: center; border-bottom: 1px solid #eee; }
        .menu-item { padding: 15px 20px; display: flex; align-items: center; color: #333; cursor: pointer; text-decoration: none; }
        .menu-item:hover, .menu-item.active { background: #fff5f6; color: #e94560; border-left: 4px solid #e94560; }
        .menu-item i { width: 30px; }
        .main { margin-left: 250px; flex: 1; }
        .top-bar { background: #fff; padding: 15px 25px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; }
        .content { padding: 30px; }
        .logout { background: #ff4d4d; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<script>
    if (!localStorage.getItem("userEmail")) { window.location.href = "index.html"; }
</script>

<div class="sidebar">
    <div class="sidebar-header">FASTRAFFIC</div>
    <div class="menu-item active" onclick="show('trangchu')"><i class="fas fa-home"></i> Trang chủ</div>
    <div class="menu-item" onclick="show('lichsu')"><i class="fas fa-history"></i> Lịch sử</div>
    <div class="menu-item" onclick="show('quydinh')"><i class="fas fa-gavel"></i> Quy định</div>
    <div class="menu-item" onclick="show('ruttien')"><i class="fas fa-wallet"></i> Rút tiền</div>
</div>

<div class="main">
    <div class="top-bar">
        <span>Chào, <b id="userMail"></b></span>
        <button class="logout" onclick="logout()">Đăng xuất</button>
    </div>
    <div class="content" id="view"></div>
</div>

<script>
    document.getElementById("userMail").innerText = localStorage.getItem("userEmail");

    function show(p) {
        let v = document.getElementById("view");
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        event.currentTarget.classList.add('active');

        if(p === 'trangchu') v.innerHTML = "<h2>Trang chủ</h2><p>Chào mừng bạn!</p>";
        else if(p === 'quydinh') v.innerHTML = "<h2>Quy định</h2><p>Không gian lận.</p>";
        else v.innerHTML = "<h2>" + p + "</h2><p>Đang cập nhật...</p>";
    }

    function logout() {
        localStorage.removeItem("userEmail");
        window.location.href = "index.html";
    }

    show('trangchu');
</script>

</body>
</html>

